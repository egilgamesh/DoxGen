services:
  postgres:
    image: postgres:16
    environment:
      POSTGRES_USER: dox
      POSTGRES_PASSWORD: doxpass
      POSTGRES_DB: doxai
    ports:
      - "5432:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data

  ollama:
    image: ollama/ollama:latest
    ports:
      - "11434:11434"
    volumes:
      - ollama:/root/.ollama

  ocr-service:
    build: ./ocr-service
    ports:
      - "8010:8000"

  embed-service:
    build: ./embed-service
    ports:
      - "8011:8000"

  vector-service:
    build: ./vector-service
    environment:
      DATABASE_URL: postgresql+psycopg://dox:doxpass@postgres:5432/doxai
    depends_on:
      - postgres
    ports:
      - "8012:8000"

  llm-service:
    build: ./llm-service
    environment:
      OLLAMA_URL: http://ollama:11434
      OLLAMA_MODEL: llama3.1:8b
    depends_on:
      - ollama
    ports:
      - "8013:8000"

  rag-service:
    build: ./rag-service
    environment:
      VECTOR_SERVICE_URL: http://vector-service:8000
      EMBED_SERVICE_URL: http://embed-service:8000
      LLM_SERVICE_URL: http://llm-service:8000
    depends_on:
      - vector-service
      - embed-service
      - llm-service
    ports:
      - "8014:8000"

volumes:
  pgdata:
  ollama:
